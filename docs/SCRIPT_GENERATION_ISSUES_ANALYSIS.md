# 脚本生成核心问题分析

## 问题1：热点选择错误

### 问题描述
用户手动关联的是"林允"的热点和"电动床"商品，但生成的是"杨瀚森"和"电动床"的脚本。

### 可能原因
1. **前端传递错误**：前端可能传递了错误的热点ID
2. **数据库查询错误**：后端查询时可能使用了错误的条件
3. **热点ID混淆**：可能有多个热点，ID被混淆了

### 检查点
- 前端是否正确获取和传递hotspot_id
- 后端是否正确使用传入的hotspot_id查询数据库
- 日志中记录的热点ID和标题是否匹配

### 修复方案
1. 在任务开始时添加详细的日志，记录传入的hotspot_id和查询到的热点信息
2. 在Agent执行时，再次验证热点ID和标题是否匹配
3. 在前端提交时，添加验证和日志

## 问题2：脚本多样性不足

### 问题描述
同一个产品针对同一个热点，生成的多个脚本完全一样。

### 当前实现
- 代码中已经传入了`script_index`和`total_scripts`
- Agent的提示词中已经添加了多样性要求
- 但可能LLM没有很好地理解或执行多样性要求

### 修复方案
1. **增强多样性提示**：
   - 明确要求每个脚本使用不同的开场方式
   - 要求不同的叙事结构
   - 要求不同的卖点突出
   - 要求不同的情感调性

2. **增加温度参数**：
   - 不同脚本使用不同的temperature值
   - 确保生成结果的随机性

3. **添加示例对比**：
   - 在提示词中明确说明"不要重复之前的脚本"
   - 提供不同脚本的示例结构

## 问题3：UI层级错误

### 问题描述
当前是"标题-脚本（多条）"的平铺展示，应该是"商品-热点-脚本（多个）"的层级展示。

### 当前UI结构
```
脚本列表（平铺）
  - 脚本1（标题：xxx）
  - 脚本2（标题：xxx）
  - 脚本3（标题：xxx）
```

### 期望UI结构
```
商品1
  └─ 热点1
      ├─ 脚本1（版本1）
      ├─ 脚本2（版本2）
      └─ 脚本3（版本3）
  └─ 热点2
      ├─ 脚本4（版本1）
      └─ 脚本5（版本2）
商品2
  └─ 热点3
      └─ 脚本6（版本1）
```

### 修复方案
1. **后端API调整**：
   - 修改脚本列表API，按商品-热点分组返回
   - 或者前端进行分组处理

2. **前端UI重构**：
   - 使用树形结构或折叠面板
   - 商品 -> 热点 -> 脚本（多个）的层级展示
   - 支持展开/折叠

## 问题4：脚本内容枯燥无味

### 问题描述
当前脚本台词太简单，缺乏吸引力，正常人看了全无兴趣。

### 当前问题
- 台词过于简单（如"运动后需要极致放松"）
- 缺乏情感共鸣
- 缺乏故事性
- 缺乏吸引力

### 修复方案
1. **增强提示词**：
   - 要求台词要有吸引力、有故事性
   - 要求使用情感化表达
   - 要求使用具体场景和细节
   - 要求有冲突、有转折

2. **提供示例**：
   - 在提示词中提供好的台词示例
   - 说明什么是"有吸引力"的台词

3. **增加要求**：
   - 台词要能引起观众共鸣
   - 要有具体场景描述
   - 要有情感起伏

