# å°çº¢ä¹¦çˆ¬è™«å®ç°çŠ¶æ€

## å½“å‰çŠ¶æ€

### âœ… å·²å®Œæˆ

1. **åŸºç¡€æ¡†æ¶åˆ›å»º**:
   - âœ… åˆ›å»ºäº† `XiaohongshuCrawler` ç±»ï¼ˆ`backend/app/crawlers/xiaohongshu_crawler.py`ï¼‰
   - âœ… ç»§æ‰¿ `BaseCrawler`ï¼Œç¬¦åˆç»Ÿä¸€æ¥å£è§„èŒƒ
   - âœ… é›†æˆåˆ° `HotspotMonitorService`

2. **æ¶æ„é›†æˆ**:
   - âœ… åœ¨ `HotspotMonitorService` ä¸­æ·»åŠ äº†å°çº¢ä¹¦ä¸“ç”¨çˆ¬è™«æ”¯æŒ
   - âœ… æ£€æµ‹åˆ°å°çº¢ä¹¦å¹³å°æ—¶ï¼Œè‡ªåŠ¨ä½¿ç”¨ä¸“ç”¨çˆ¬è™«
   - âœ… å…¶ä»–å¹³å°ç»§ç»­ä½¿ç”¨ `TrendRadarCrawler`

3. **é”™è¯¯å¤„ç†**:
   - âœ… æ·»åŠ äº†é‡è¯•æœºåˆ¶
   - âœ… æ·»åŠ äº†é”™è¯¯æ—¥å¿—
   - âœ… ä¼˜é›…é™çº§å¤„ç†

### âš ï¸ å¾…å®ç°

1. **é¡µé¢ç»“æ„åˆ†æ**:
   - âŒ éœ€è¦åˆ†æå°çº¢ä¹¦å®é™…çƒ­æœé¡µé¢ç»“æ„
   - âŒ éœ€è¦ç¡®å®šæ•°æ®æå–æ–¹æ³•ï¼ˆHTMLè§£æ vs JSON APIï¼‰

2. **æ•°æ®è§£æé€»è¾‘**:
   - âŒ `_parse_html` æ–¹æ³•éœ€è¦æ ¹æ®å®é™…é¡µé¢ç»“æ„å®ç°
   - âŒ `_parse_json` æ–¹æ³•éœ€è¦æ ¹æ®å®é™…APIå“åº”æ ¼å¼å®ç°

3. **åçˆ¬è™«å¤„ç†**:
   - âš ï¸ åŸºç¡€è¯·æ±‚å¤´å·²é…ç½®
   - âŒ å¯èƒ½éœ€è¦Cookieç®¡ç†
   - âŒ å¯èƒ½éœ€è¦éªŒè¯ç å¤„ç†
   - âŒ å¯èƒ½éœ€è¦æµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼ˆPlaywright/Seleniumï¼‰

## å‚è€ƒ BettaFish å®ç°

æ ¹æ® [BettaFish](https://github.com/666ghj/BettaFish) é¡¹ç›®çš„æ¶æ„ï¼š

1. **MindSpider æ¨¡å—**: è´Ÿè´£æ•°æ®é‡‡é›†ï¼Œæ”¯æŒå°çº¢ä¹¦ç­‰å¹³å°
2. **MediaEngine æ¨¡å—**: åª’ä½“å¹³å°æ•°æ®å¤„ç†
3. **ç»Ÿä¸€æ¥å£**: å„æ¨¡å—å®ç°ç»Ÿä¸€æ¥å£ï¼Œä¾¿äºæ‰©å±•

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### é˜¶æ®µ1ï¼šåˆ†æ BettaFish æºç ï¼ˆæ¨èï¼‰

1. **æŸ¥çœ‹ BettaFish GitHub ä»“åº“**:
   ```bash
   # å…‹éš†æˆ–æŸ¥çœ‹ BettaFish ä»“åº“
   # é‡ç‚¹å…³æ³¨ MindSpider ç›®å½•ä¸‹çš„ä»£ç 
   ```

2. **åˆ†æå°çº¢ä¹¦ç›¸å…³å®ç°**:
   - æŸ¥çœ‹å¦‚ä½•çˆ¬å–å°çº¢ä¹¦æ•°æ®
   - å­¦ä¹ å…¶åçˆ¬è™«å¤„ç†æ–¹å¼
   - ç†è§£å…¶æ•°æ®è§£æé€»è¾‘

3. **æå–å…³é”®ä»£ç **:
   - å¤åˆ¶ç›¸å…³çš„çˆ¬è™«é€»è¾‘
   - é€‚é…åˆ°æˆ‘ä»¬çš„ `XiaohongshuCrawler` ç±»

### é˜¶æ®µ2ï¼šåˆ†æå°çº¢ä¹¦å®é™…é¡µé¢

1. **è®¿é—®å°çº¢ä¹¦çƒ­æœé¡µé¢**:
   - æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
   - åˆ†æé¡µé¢DOMç»“æ„
   - æŸ¥çœ‹ç½‘ç»œè¯·æ±‚ï¼ˆæ˜¯å¦æœ‰APIç«¯ç‚¹ï¼‰

2. **ç¡®å®šæ•°æ®æå–æ–¹æ³•**:
   - HTMLè§£æï¼šä½¿ç”¨ BeautifulSoup
   - JSON APIï¼šç›´æ¥è§£æJSON
   - æ··åˆæ¨¡å¼ï¼šç»“åˆä½¿ç”¨

### é˜¶æ®µ3ï¼šå®ç°è§£æé€»è¾‘

1. **å®ç° `_parse_html` æ–¹æ³•**:
   ```python
   def _parse_html(self, html: str) -> List[Dict[str, Any]]:
       soup = BeautifulSoup(html, 'html.parser')
       # æ ¹æ®å®é™…DOMç»“æ„æå–æ•°æ®
       # ...
   ```

2. **å®ç° `_parse_json` æ–¹æ³•**:
   ```python
   def _parse_json(self, data: Dict[str, Any]) -> List[Dict[str, Any]]:
       # æ ¹æ®å®é™…APIå“åº”æ ¼å¼æå–æ•°æ®
       # ...
   ```

### é˜¶æ®µ4ï¼šæµ‹è¯•å’Œä¼˜åŒ–

1. **å•å…ƒæµ‹è¯•**:
   - æµ‹è¯•æ•°æ®è§£æé€»è¾‘
   - æµ‹è¯•é”™è¯¯å¤„ç†

2. **é›†æˆæµ‹è¯•**:
   - æµ‹è¯•å®Œæ•´æŠ“å–æµç¨‹
   - æµ‹è¯•ä¸å…¶ä»–å¹³å°çš„å…¼å®¹æ€§

3. **æ€§èƒ½ä¼˜åŒ–**:
   - ä¼˜åŒ–è¯·æ±‚é¢‘ç‡
   - æ·»åŠ ç¼“å­˜æœºåˆ¶

## æŠ€æœ¯æŒ‘æˆ˜

### 1. åçˆ¬è™«æœºåˆ¶

å°çº¢ä¹¦å¯èƒ½æœ‰è¾ƒå¼ºçš„åçˆ¬è™«æœºåˆ¶ï¼Œéœ€è¦ï¼š

1. **Cookieç®¡ç†**:
   - å¯èƒ½éœ€è¦ç™»å½•è·å–Cookie
   - éœ€è¦ç»´æŠ¤Cookieæœ‰æ•ˆæ€§

2. **éªŒè¯ç å¤„ç†**:
   - å¯èƒ½éœ€è¦å¤„ç†éªŒè¯ç 
   - è€ƒè™‘ä½¿ç”¨OCRæˆ–ç¬¬ä¸‰æ–¹éªŒè¯ç æœåŠ¡

3. **è¯·æ±‚é¢‘ç‡æ§åˆ¶**:
   - å®ç°æ™ºèƒ½å»¶è¿Ÿ
   - é¿å…è¢«é™æµ

### 2. é¡µé¢ç»“æ„å˜åŒ–

å°çº¢ä¹¦å¯èƒ½é¢‘ç¹æ›´æ–°é¡µé¢ç»“æ„ï¼š

1. **çµæ´»è§£æ**:
   - ä½¿ç”¨å¤šä¸ªCSSé€‰æ‹©å™¨
   - å®ç°å®¹é”™æœºåˆ¶

2. **ç‰ˆæœ¬å…¼å®¹**:
   - æ”¯æŒå¤šç‰ˆæœ¬è§£æé€»è¾‘
   - æ£€æµ‹ç»“æ„å˜åŒ–

### 3. æ•°æ®å‡†ç¡®æ€§

ç¡®ä¿æå–çš„æ•°æ®å‡†ç¡®ï¼š

1. **æ•°æ®éªŒè¯**:
   - éªŒè¯å¿…è¦å­—æ®µå­˜åœ¨
   - éªŒè¯æ•°æ®æ ¼å¼

2. **æ•°æ®æ¸…æ´—**:
   - å»é™¤æ— æ•ˆæ•°æ®
   - æ ‡å‡†åŒ–æ•°æ®æ ¼å¼

## æ›¿ä»£æ–¹æ¡ˆ

å¦‚æœç›´æ¥çˆ¬å–å›°éš¾ï¼Œå¯ä»¥è€ƒè™‘ï¼š

### æ–¹æ¡ˆAï¼šä½¿ç”¨æµè§ˆå™¨è‡ªåŠ¨åŒ–

ä½¿ç”¨ Playwright æˆ– Selenium æ¨¡æ‹ŸçœŸå®æµè§ˆå™¨ï¼š

```python
from playwright.async_api import async_playwright

async def crawl_with_playwright():
    async with async_playwright() as p:
        browser = await p.chromium.launch(headless=True)
        page = await browser.new_page()
        await page.goto("https://www.xiaohongshu.com/explore")
        # ç­‰å¾…é¡µé¢åŠ è½½
        await page.wait_for_selector('.hot-item')
        # æå–æ•°æ®
        data = await page.evaluate("""() => {
            // JavaScriptä»£ç æå–æ•°æ®
        }""")
        await browser.close()
        return data
```

### æ–¹æ¡ˆBï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹æœåŠ¡

å¯»æ‰¾æä¾›å°çº¢ä¹¦æ•°æ®çš„APIæœåŠ¡ã€‚

### æ–¹æ¡ˆCï¼šç­‰å¾… TrendRadar API æ”¯æŒ

è”ç³» API æä¾›æ–¹ï¼Œç­‰å¾…å®˜æ–¹æ”¯æŒã€‚

## å½“å‰ä»£ç ç»“æ„

```
backend/app/crawlers/
  â”œâ”€â”€ base.py                    # çˆ¬è™«åŸºç±»
  â”œâ”€â”€ trendradar_crawler.py      # TrendRadarçˆ¬è™«ï¼ˆç°æœ‰ï¼‰
  â””â”€â”€ xiaohongshu_crawler.py     # å°çº¢ä¹¦çˆ¬è™«ï¼ˆæ–°å¢ï¼Œå¾…å®Œå–„ï¼‰

backend/app/services/hotspot/
  â””â”€â”€ service.py                 # å·²é›†æˆå°çº¢ä¹¦çˆ¬è™«æ”¯æŒ
```

## æµ‹è¯•æ–¹æ³•

### 1. æµ‹è¯•åŸºç¡€æ¡†æ¶

```python
# æµ‹è¯•å°çº¢ä¹¦çˆ¬è™«åˆå§‹åŒ–
from app.crawlers.xiaohongshu_crawler import XiaohongshuCrawler

crawler = XiaohongshuCrawler()
# åº”è¯¥æˆåŠŸåˆå§‹åŒ–
```

### 2. æµ‹è¯•é›†æˆ

```python
# æµ‹è¯•æœåŠ¡é›†æˆ
from app.services.hotspot.service import HotspotMonitorService

service = HotspotMonitorService()
hotspots = await service.fetch_hotspots("xiaohongshu")
# åº”è¯¥è°ƒç”¨ XiaohongshuCrawler
```

### 3. æµ‹è¯•å®Œæ•´æµç¨‹

```bash
# é€šè¿‡APIè§¦å‘æŠ“å–
curl -X POST http://localhost:8000/api/v1/hotspots/fetch?platform=xiaohongshu
```

## ç›¸å…³æ–‡æ¡£

- `docs/BETTAFISH_XIAOHONGSHU_INTEGRATION_PLAN.md` - é›†æˆæ–¹æ¡ˆè¯¦ç»†æ–‡æ¡£
- `docs/XIAOHONGSHU_API_DIAGNOSIS.md` - APIé—®é¢˜è¯Šæ–­
- `docs/TRENDRADAR_403_500_DIAGNOSIS.md` - TrendRadaré”™è¯¯è¯Šæ–­

## æ€»ç»“

âœ… **åŸºç¡€æ¡†æ¶å·²å®Œæˆ**ï¼Œå¯ä»¥å¼€å§‹å®ç°å…·ä½“é€»è¾‘

ğŸ“‹ **ä¸‹ä¸€æ­¥**:
1. åˆ†æ BettaFish çš„ MindSpider æ¨¡å—å®ç°
2. åˆ†æå°çº¢ä¹¦å®é™…é¡µé¢ç»“æ„
3. å®ç°æ•°æ®è§£æé€»è¾‘
4. æµ‹è¯•å’Œä¼˜åŒ–

