# å¼€å‘ç¼ºå£åˆ†ææŠ¥å‘Š

æ ¹æ®ç”¨æˆ·å¯¹ `USER_JOURNEY.md` çš„ä¿®æ”¹ï¼Œä»¥ä¸‹æ˜¯éœ€è¦å®Œå–„çš„åœ°æ–¹å’ŒTrendRadarå¼€å‘ä¸åˆ°ä½çš„åœ°æ–¹ã€‚

## ğŸ”´ å…³é”®ç¼ºå£

### 1. è¯­ä¹‰å…³è”åº¦å’Œæƒ…æ„Ÿå…³è”åº¦è®¡ç®—ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

**ç”¨æˆ·è¦æ±‚**ï¼š
- ä¸æ˜¯äººå·¥åšå…³é”®è¯ç­›é€‰
- å·¥å…·æ ¹æ®ç›´æ’­é—´çš„ä¸»è¥ç±»ç›®ï¼Œè¿›è¡Œå…³é”®è¯è¯­ä¹‰å…³è”åº¦ã€æƒ…æ„Ÿå…³è”åº¦è¿›è¡Œè‡ªåŠ¨ç­›é€‰

**å½“å‰å®ç°**ï¼š
- âŒ åªå®ç°äº†ç®€å•çš„å…³é”®è¯å­—ç¬¦ä¸²åŒ¹é…ï¼ˆ`filter_hotspots`æ–¹æ³•ï¼‰
- âŒ æ²¡æœ‰ä½¿ç”¨è¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®—
- âŒ æ²¡æœ‰æƒ…æ„Ÿå…³è”åº¦åˆ†æ

**éœ€è¦å®ç°**ï¼š
1. **é›†æˆEmbeddingæ¨¡å‹**
   - ä½¿ç”¨DeepSeek Embedding APIæˆ–OpenAI Embedding API
   - å°†çƒ­ç‚¹æ ‡é¢˜/å†…å®¹è½¬æ¢ä¸ºå‘é‡
   - å°†ç›´æ’­é—´ç±»ç›®/å•†å“ä¿¡æ¯è½¬æ¢ä¸ºå‘é‡
   - è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦ä½œä¸ºè¯­ä¹‰å…³è”åº¦

2. **æƒ…æ„Ÿå…³è”åº¦åˆ†æ**
   - ä½¿ç”¨æƒ…æ„Ÿåˆ†ææ¨¡å‹ï¼ˆå¦‚ä¸­æ–‡æƒ…æ„Ÿåˆ†æï¼‰
   - åˆ†æçƒ­ç‚¹å†…å®¹çš„æƒ…æ„Ÿå€¾å‘
   - åˆ†æå•†å“/ç›´æ’­é—´çš„æƒ…æ„Ÿå®šä½
   - è®¡ç®—æƒ…æ„ŸåŒ¹é…åº¦

3. **åŒ¹é…åº¦è®¡ç®—ä¼˜åŒ–**
   - è¯­ä¹‰å…³è”åº¦æƒé‡ï¼š60%
   - æƒ…æ„Ÿå…³è”åº¦æƒé‡ï¼š30%
   - å…³é”®è¯åŒ¹é…æƒé‡ï¼š10%ï¼ˆä½œä¸ºè¡¥å……ï¼‰

**ä»£ç ä½ç½®**ï¼š
- `backend/app/services/hotspot/service.py` - `filter_hotspots`æ–¹æ³•éœ€è¦é‡å†™
- éœ€è¦æ–°å¢ï¼š`backend/app/utils/embedding.py` - Embeddingå®¢æˆ·ç«¯
- éœ€è¦æ–°å¢ï¼š`backend/app/utils/sentiment.py` - æƒ…æ„Ÿåˆ†æå®¢æˆ·ç«¯

---

### 2. åŒ¹é…åº¦åº”è¯¥æ˜¯ä¸ç›´æ’­é—´ä¸»æ¨å•†å“çš„åŒ¹é…åº¦ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

**ç”¨æˆ·è¦æ±‚**ï¼š
- åŒ¹é…åº¦æ˜¯æŒ‡è·Ÿç›´æ’­é—´ä¸»æ¨å•†å“çš„åŒ¹é…åº¦

**å½“å‰å®ç°**ï¼š
- âŒ åŒ¹é…åº¦æ˜¯åŸºäºç›´æ’­é—´å…³é”®è¯ï¼Œä¸æ˜¯åŸºäºå•†å“
- âŒ æ²¡æœ‰è·å–ç›´æ’­é—´çš„ä¸»æ¨å•†å“é€»è¾‘

**éœ€è¦å®ç°**ï¼š
1. **è·å–ä¸»æ¨å•†å“**
   - æ ¹æ®`live_room_id`å’Œ`live_date`æŸ¥è¯¢`products`è¡¨
   - æ‰¾åˆ°å¯¹åº”æ—¥æœŸçš„ä¸»æ¨å•†å“ï¼ˆå¯èƒ½æœ‰å¤šä¸ªï¼Œå–æœ€æ–°çš„æˆ–æŒ‡å®šçš„ï¼‰

2. **è®¡ç®—çƒ­ç‚¹ä¸å•†å“çš„åŒ¹é…åº¦**
   - çƒ­ç‚¹æ ‡é¢˜/å†…å®¹ vs å•†å“åç§°/æè¿°/å–ç‚¹
   - ä½¿ç”¨è¯­ä¹‰å…³è”åº¦è®¡ç®—
   - è€ƒè™‘å•†å“å“ç±»ã€å“ç‰Œã€æ ¸å¿ƒå–ç‚¹

3. **æ›´æ–°åŒ¹é…åº¦å­—æ®µ**
   - `match_score`å­—æ®µåº”è¯¥å­˜å‚¨ä¸å•†å“çš„åŒ¹é…åº¦
   - åœ¨ä¿å­˜çƒ­ç‚¹æ—¶ï¼Œéœ€è¦ä¼ å…¥å•†å“ä¿¡æ¯

**ä»£ç ä½ç½®**ï¼š
- `backend/app/services/hotspot/service.py` - `filter_hotspots`æ–¹æ³•éœ€è¦ä¿®æ”¹
- `backend/app/services/hotspot/tasks.py` - `fetch_daily_hotspots`ä»»åŠ¡éœ€è¦ä¼ å…¥å•†å“ä¿¡æ¯
- éœ€è¦æ–°å¢ï¼š`backend/app/services/hotspot/service.py` - `calculate_product_match_score`æ–¹æ³•

---

### 3. å‰ç«¯æ°”æ³¡å›¾å±•ç¤ºï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

**ç”¨æˆ·è¦æ±‚**ï¼š
- ä¸èƒ½æ˜¯åˆ—è¡¨æˆ–è€…è¯äº‘çš„å‘ˆç°ç»“æœ
- åº”è¯¥æ˜¯æ°”æ³¡å›¾ï¼ˆBubble Chartï¼‰
- æ¨ªè½´ï¼šçƒ­åº¦ï¼ˆheat_scoreï¼‰
- çºµè½´ï¼šçƒ­åº¦å¢é•¿é€Ÿç‡ï¼ˆheat_growth_rateï¼‰
- åŒºåˆ†ç›´æ’­é—´ç±»ç›®è¾“å‡ºç»“æœï¼ˆä¸åŒé¢œè‰²/å½¢çŠ¶ï¼‰

**å½“å‰å®ç°**ï¼š
- âŒ å‰ç«¯åªæœ‰åˆ—è¡¨å±•ç¤ºï¼ˆ`HotspotsView.vue`ï¼‰
- âŒ æ²¡æœ‰æ°”æ³¡å›¾ç»„ä»¶
- âŒ æ²¡æœ‰çƒ­åº¦å¢é•¿é€Ÿç‡æ•°æ®

**éœ€è¦å®ç°**ï¼š
1. **åç«¯APIæ”¯æŒ**
   - éœ€è¦è¿”å›çƒ­åº¦å¢é•¿é€Ÿç‡ï¼ˆ`heat_growth_rate`ï¼‰
   - éœ€è¦æŒ‰ç›´æ’­é—´ç±»ç›®åˆ†ç»„æ•°æ®
   - APIç«¯ç‚¹ï¼š`GET /api/v1/hotspots/visualization`

2. **æ•°æ®æ¨¡å‹æ‰©å±•**
   - `Hotspot`æ¨¡å‹éœ€è¦æ·»åŠ `heat_growth_rate`å­—æ®µ
   - éœ€è¦è®¡ç®—æˆ–ä»TrendRadarè·å–

3. **å‰ç«¯ç»„ä»¶**
   - ä½¿ç”¨EChartsæˆ–Chart.jsåˆ›å»ºæ°”æ³¡å›¾
   - æ¨ªè½´ï¼šçƒ­åº¦
   - çºµè½´ï¼šçƒ­åº¦å¢é•¿é€Ÿç‡
   - æ°”æ³¡å¤§å°ï¼šåŒ¹é…åº¦
   - é¢œè‰²ï¼šç›´æ’­é—´ç±»ç›®
   - æ”¯æŒäº¤äº’ï¼šç‚¹å‡»æ°”æ³¡æŸ¥çœ‹è¯¦æƒ…

**ä»£ç ä½ç½®**ï¼š
- `backend/app/models/hotspot.py` - æ·»åŠ `heat_growth_rate`å­—æ®µ
- `backend/app/api/v1/endpoints/hotspots.py` - æ–°å¢å¯è§†åŒ–APIç«¯ç‚¹
- `frontend/src/views/HotspotsView.vue` - æ·»åŠ æ°”æ³¡å›¾ç»„ä»¶
- éœ€è¦æ–°å¢ï¼š`frontend/src/components/HotspotBubbleChart.vue`

---

### 4. TrendRadaré›†æˆç¼ºå£

#### 4.1 çƒ­åº¦å¢é•¿é€Ÿç‡æ•°æ®ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

**é—®é¢˜**ï¼š
- TrendRadar APIå¯èƒ½ä¸ç›´æ¥æä¾›çƒ­åº¦å¢é•¿é€Ÿç‡
- éœ€è¦è®¡ç®—æˆ–è¯·æ±‚é¢å¤–æ•°æ®

**éœ€è¦ç¡®è®¤**ï¼š
1. TrendRadar APIæ˜¯å¦æä¾›ï¼š
   - å†å²çƒ­åº¦æ•°æ®
   - çƒ­åº¦å˜åŒ–è¶‹åŠ¿
   - å¢é•¿ç‡å­—æ®µ

2. å¦‚æœä¸æä¾›ï¼Œéœ€è¦ï¼š
   - ä¿å­˜å†å²çƒ­åº¦æ•°æ®
   - è®¡ç®—å¢é•¿ç‡ï¼š`(å½“å‰çƒ­åº¦ - å†å²çƒ­åº¦) / æ—¶é—´å·®`
   - éœ€è¦å­˜å‚¨å¤šä¸ªæ—¶é—´ç‚¹çš„çƒ­åº¦å€¼

**ä»£ç ä½ç½®**ï¼š
- `backend/app/utils/trendradar.py` - æ£€æŸ¥APIè¿”å›æ•°æ®
- `backend/app/models/hotspot.py` - å¯èƒ½éœ€è¦å†å²æ•°æ®è¡¨
- `backend/app/services/hotspot/service.py` - è®¡ç®—å¢é•¿ç‡é€»è¾‘

#### 4.2 TrendRadaræ•°æ®å­—æ®µå®Œæ•´æ€§ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

**éœ€è¦ç¡®è®¤çš„å­—æ®µ**ï¼š
- `heat_score` - å½“å‰çƒ­åº¦ âœ…ï¼ˆå·²æœ‰ï¼‰
- `heat_growth_rate` - çƒ­åº¦å¢é•¿é€Ÿç‡ âŒï¼ˆç¼ºå¤±ï¼‰
- `publish_time` - å‘å¸ƒæ—¶é—´ âœ…ï¼ˆå·²æœ‰ï¼‰
- `tags` - æ ‡ç­¾ âœ…ï¼ˆå·²æœ‰ï¼‰
- å…¶ä»–å¯èƒ½éœ€è¦çš„å­—æ®µï¼š
  - çƒ­åº¦å†å²æ•°æ®
  - å‚ä¸äººæ•°
  - äº’åŠ¨ç‡

**ä»£ç ä½ç½®**ï¼š
- `backend/app/utils/trendradar.py` - æ£€æŸ¥APIè¿”å›æ•°æ®ç»“æ„
- `backend/app/models/hotspot.py` - ç¡®ä¿å­—æ®µå®Œæ•´

---

## ğŸ“‹ å¾…åŠäº‹é¡¹æ¸…å•

### ğŸ”´ P0 - å¿…é¡»å®ç°ï¼ˆé˜»å¡æ ¸å¿ƒåŠŸèƒ½ï¼‰

1. **è¯­ä¹‰å…³è”åº¦è®¡ç®—**
   - [ ] é›†æˆEmbedding APIï¼ˆDeepSeekæˆ–OpenAIï¼‰
   - [ ] å®ç°å‘é‡ç›¸ä¼¼åº¦è®¡ç®—
   - [ ] é‡å†™`filter_hotspots`æ–¹æ³•

2. **å•†å“åŒ¹é…åº¦è®¡ç®—**
   - [ ] å®ç°è·å–ä¸»æ¨å•†å“é€»è¾‘
   - [ ] å®ç°çƒ­ç‚¹ä¸å•†å“çš„è¯­ä¹‰åŒ¹é…åº¦è®¡ç®—
   - [ ] æ›´æ–°åŒ¹é…åº¦å­—æ®µå«ä¹‰

3. **å‰ç«¯æ°”æ³¡å›¾**
   - [ ] æ·»åŠ `heat_growth_rate`å­—æ®µåˆ°æ•°æ®æ¨¡å‹
   - [ ] å®ç°åç«¯å¯è§†åŒ–API
   - [ ] åˆ›å»ºæ°”æ³¡å›¾ç»„ä»¶
   - [ ] æ›¿æ¢åˆ—è¡¨å±•ç¤ºä¸ºæ°”æ³¡å›¾

### ğŸŸ¡ P1 - é‡è¦ï¼ˆå½±å“ç”¨æˆ·ä½“éªŒï¼‰

4. **æƒ…æ„Ÿå…³è”åº¦åˆ†æ**
   - [ ] é›†æˆæƒ…æ„Ÿåˆ†æAPI
   - [ ] å®ç°æƒ…æ„ŸåŒ¹é…åº¦è®¡ç®—
   - [ ] æ•´åˆåˆ°åŒ¹é…åº¦è®¡ç®—ä¸­

5. **çƒ­åº¦å¢é•¿é€Ÿç‡è®¡ç®—**
   - [ ] ç¡®è®¤TrendRadar APIæ˜¯å¦æä¾›
   - [ ] å¦‚æœä¸æä¾›ï¼Œå®ç°è®¡ç®—é€»è¾‘
   - [ ] ä¿å­˜å†å²æ•°æ®ç”¨äºè®¡ç®—

### ğŸŸ¢ P2 - ä¼˜åŒ–ï¼ˆæå‡ä½“éªŒï¼‰

6. **æ•°æ®æ¨¡å‹ä¼˜åŒ–**
   - [ ] æ·»åŠ `heat_growth_rate`å­—æ®µ
   - [ ] è€ƒè™‘æ˜¯å¦éœ€è¦å†å²æ•°æ®è¡¨
   - [ ] ä¼˜åŒ–ç´¢å¼•

7. **å‰ç«¯äº¤äº’ä¼˜åŒ–**
   - [ ] æ°”æ³¡å›¾äº¤äº’åŠŸèƒ½
   - [ ] ç­›é€‰å’Œç­›é€‰åŠŸèƒ½
   - [ ] è¯¦æƒ…æŸ¥çœ‹

---

## ğŸ”§ æŠ€æœ¯å®ç°å»ºè®®

### 1. è¯­ä¹‰å…³è”åº¦å®ç°

```python
# backend/app/utils/embedding.py
class EmbeddingClient:
    async def get_embedding(self, text: str) -> List[float]:
        """è·å–æ–‡æœ¬çš„å‘é‡è¡¨ç¤º"""
        # è°ƒç”¨DeepSeek Embedding API
        pass
    
    def cosine_similarity(self, vec1: List[float], vec2: List[float]) -> float:
        """è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦"""
        pass
```

### 2. å•†å“åŒ¹é…åº¦è®¡ç®—

```python
# backend/app/services/hotspot/service.py
def calculate_product_match_score(
    self,
    hotspot: Dict[str, Any],
    product: Product
) -> float:
    """è®¡ç®—çƒ­ç‚¹ä¸å•†å“çš„åŒ¹é…åº¦"""
    # 1. è·å–çƒ­ç‚¹å’Œå•†å“çš„embedding
    # 2. è®¡ç®—è¯­ä¹‰ç›¸ä¼¼åº¦
    # 3. è®¡ç®—æƒ…æ„ŸåŒ¹é…åº¦
    # 4. ç»¼åˆè®¡ç®—åŒ¹é…åº¦
    pass
```

### 3. æ°”æ³¡å›¾æ•°æ®API

```python
# backend/app/api/v1/endpoints/hotspots.py
@router.get("/visualization")
async def get_hotspots_visualization(
    live_room_id: Optional[str] = None,
    db: Session = Depends(get_db)
):
    """è·å–çƒ­ç‚¹å¯è§†åŒ–æ•°æ®ï¼ˆæ°”æ³¡å›¾ï¼‰"""
    # è¿”å›æ ¼å¼ï¼š
    # {
    #   "categories": [
    #     {
    #       "category": "å¥³è£…",
    #       "hotspots": [
    #         {
    #           "id": "...",
    #           "title": "...",
    #           "heat_score": 95,
    #           "heat_growth_rate": 0.15,
    #           "match_score": 0.85
    #         }
    #       ]
    #     }
    #   ]
    # }
    pass
```

### 4. å‰ç«¯æ°”æ³¡å›¾ç»„ä»¶

```vue
<!-- frontend/src/components/HotspotBubbleChart.vue -->
<template>
  <div ref="chartContainer" style="width: 100%; height: 600px;"></div>
</template>

<script setup lang="ts">
import * as echarts from 'echarts'
// ä½¿ç”¨EChartsåˆ›å»ºæ°”æ³¡å›¾
// æ¨ªè½´ï¼šçƒ­åº¦
// çºµè½´ï¼šçƒ­åº¦å¢é•¿é€Ÿç‡
// æ°”æ³¡å¤§å°ï¼šåŒ¹é…åº¦
// é¢œè‰²ï¼šç›´æ’­é—´ç±»ç›®
</script>
```

---

## ğŸ“ æ•°æ®åº“è¿ç§»

éœ€è¦æ·»åŠ çš„å­—æ®µï¼š

```python
# backend/app/models/hotspot.py
class Hotspot(BaseModel):
    # ... ç°æœ‰å­—æ®µ ...
    heat_growth_rate = Column(Float, nullable=True)  # çƒ­åº¦å¢é•¿é€Ÿç‡
    product_match_score = Column(Float, nullable=True, index=True)  # ä¸å•†å“çš„åŒ¹é…åº¦ï¼ˆå¯é€‰ï¼Œå¦‚æœmatch_scoreæ”¹ä¸ºå•†å“åŒ¹é…åº¦ï¼‰
```

è¿ç§»å‘½ä»¤ï¼š
```bash
cd backend
alembic revision --autogenerate -m "Add heat_growth_rate to hotspots"
alembic upgrade head
```

---

## ğŸ” TrendRadar APIç¡®è®¤äº‹é¡¹

éœ€è¦ä¸TrendRadarå›¢é˜Ÿç¡®è®¤ï¼š

1. **APIè¿”å›æ•°æ®å­—æ®µ**
   - [ ] æ˜¯å¦åŒ…å«çƒ­åº¦å¢é•¿é€Ÿç‡ï¼Ÿ
   - [ ] æ˜¯å¦åŒ…å«å†å²çƒ­åº¦æ•°æ®ï¼Ÿ
   - [ ] æ•°æ®æ›´æ–°é¢‘ç‡ï¼Ÿ

2. **APIè°ƒç”¨æ–¹å¼**
   - [ ] æ˜¯å¦éœ€è¦é¢å¤–çš„å‚æ•°è·å–å¢é•¿ç‡ï¼Ÿ
   - [ ] æ˜¯å¦æœ‰ä¸“é—¨çš„å†å²æ•°æ®æ¥å£ï¼Ÿ

3. **æ•°æ®æ ¼å¼**
   - [ ] å¢é•¿ç‡æ˜¯ç™¾åˆ†æ¯”è¿˜æ˜¯ç»å¯¹å€¼ï¼Ÿ
   - [ ] æ—¶é—´ç²’åº¦ï¼ˆå°æ—¶/å¤©ï¼‰ï¼Ÿ

---

## ğŸ“š å‚è€ƒèµ„æ–™

- DeepSeek Embedding APIæ–‡æ¡£
- EChartsæ°”æ³¡å›¾ç¤ºä¾‹
- ä¸­æ–‡æƒ…æ„Ÿåˆ†ææ¨¡å‹
- å‘é‡ç›¸ä¼¼åº¦è®¡ç®—ç®—æ³•

---

**æœ€åæ›´æ–°**ï¼š2024å¹´12æœˆ

